{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Desktop/recreate_coffee/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line no-var\r\n  var prismaGlobal: PrismaClient | undefined;\r\n}\r\n\r\nexport const prisma =\r\n  global.prismaGlobal ||\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"error\", \"warn\"] : [\"error\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") global.prismaGlobal = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAOO,MAAM,SACX,OAAO,YAAY,IACnB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,OAAO,YAAY,GAAG","debugId":null}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Desktop/recreate_coffee/src/server/jwt.ts"],"sourcesContent":["import jwt from \"jsonwebtoken\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"dev_secret_fallback\";\r\n\r\nexport type JwtPayload = { id: number; login: string; role: string };\r\n\r\nexport function signJwt(payload: JwtPayload, days = 7) {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: `${days}d` });\r\n}\r\n\r\nexport function verifyJwt(token: string): JwtPayload | null {\r\n  try { return jwt.verify(token, JWT_SECRET) as JwtPayload; }\r\n  catch { return null; }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAItC,SAAS,QAAQ,OAAmB,EAAE,OAAO,CAAC;IACnD,OAAO,2MAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW,GAAG,KAAK,CAAC,CAAC;IAAC;AAC/D;AAEO,SAAS,UAAU,KAAa;IACrC,IAAI;QAAE,OAAO,2MAAG,CAAC,MAAM,CAAC,OAAO;IAA2B,EAC1D,OAAM;QAAE,OAAO;IAAM;AACvB","debugId":null}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Desktop/recreate_coffee/src/app/api/admin/users/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { verifyJwt } from \"@/server/jwt\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\nfunction unauthorized() {\r\n  return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n}\r\nfunction forbidden() {\r\n  return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  const token = (req.headers.get(\"authorization\") || \"\").replace(/^Bearer\\s+/i,\"\");\r\n  const user = verifyJwt(token);\r\n  if (!user) return unauthorized();\r\n  if ((user.role||\"\").toLowerCase()!==\"admin\") return forbidden();\r\n\r\n  const users = await prisma.user.findMany({\r\n    orderBy: { id: \"asc\" },\r\n    select: {\r\n      id:true, login:true, role:true, createdAt:true,\r\n      paymentMethod:true, houseNumber:true,\r\n      city: { select: { name:true } },\r\n      street: { select: { name:true } },\r\n    }\r\n  });\r\n\r\n  return NextResponse.json({\r\n    data: {\r\n      users: users.map(u=>({\r\n        id: u.id,\r\n        login: u.login,\r\n        role: u.role,\r\n        city: u.city?.name || null,\r\n        street: u.street?.name || null,\r\n        houseNumber: u.houseNumber ?? null,\r\n        paymentMethod: u.paymentMethod ?? null,\r\n        createdAt: u.createdAt.toISOString(),\r\n      }))\r\n    }, message:\"OK\", error:null\r\n  });\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n  const token = (req.headers.get(\"authorization\") || \"\").replace(/^Bearer\\s+/i,\"\");\r\n  const user = verifyJwt(token);\r\n  if (!user) return unauthorized();\r\n  if ((user.role||\"\").toLowerCase()!==\"admin\") return forbidden();\r\n\r\n  const body = await req.json().catch(()=> ({}));\r\n  const { login, password, role=\"user\", paymentMethod = \"card\" } = body || {};\r\n  if (!/^[A-Za-z][A-Za-z0-9]{2,}$/.test(login||\"\")) {\r\n    return NextResponse.json({ error:\"Invalid login\" }, { status:400 });\r\n  }\r\n  if (!(typeof password===\"string\" && /^(?=.*[^\\w\\s]).{6,}$/.test(password))) {\r\n    return NextResponse.json({ error:\"Weak password\" }, { status:400 });\r\n  }\r\n\r\n  const hash = await bcrypt.hash(password, 10);\r\n  try {\r\n    const created = await prisma.user.create({\r\n      data: { login, passwordHash: hash, role, paymentMethod }\r\n    });\r\n    return NextResponse.json({ data: { id: created.id }, message:\"Created\", error:null }, { status:201 });\r\n  } catch (e:any) {\r\n    if (String(e?.message||\"\").includes(\"Unique\")) {\r\n      return NextResponse.json({ error:\"Login already exists\" }, { status:409 });\r\n    }\r\n    return NextResponse.json({ error:\"Failed to create\" }, { status:500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}