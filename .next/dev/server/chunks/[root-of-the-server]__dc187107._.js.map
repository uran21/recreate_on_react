{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Desktop/recreate_coffee/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line no-var\r\n  var prismaGlobal: PrismaClient | undefined;\r\n}\r\n\r\nexport const prisma =\r\n  global.prismaGlobal ||\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"error\", \"warn\"] : [\"error\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") global.prismaGlobal = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAOO,MAAM,SACX,OAAO,YAAY,IACnB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,OAAO,YAAY,GAAG","debugId":null}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Desktop/recreate_coffee/src/server/jwt.ts"],"sourcesContent":["import jwt from \"jsonwebtoken\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"dev_secret_fallback\";\r\n\r\nexport type JwtPayload = { id: number; login: string; role: string };\r\n\r\nexport function signJwt(payload: JwtPayload, days = 7) {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: `${days}d` });\r\n}\r\n\r\nexport function verifyJwt(token: string): JwtPayload | null {\r\n  try { return jwt.verify(token, JWT_SECRET) as JwtPayload; }\r\n  catch { return null; }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAItC,SAAS,QAAQ,OAAmB,EAAE,OAAO,CAAC;IACnD,OAAO,2MAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW,GAAG,KAAK,CAAC,CAAC;IAAC;AAC/D;AAEO,SAAS,UAAU,KAAa;IACrC,IAAI;QAAE,OAAO,2MAAG,CAAC,MAAM,CAAC,OAAO;IAA2B,EAC1D,OAAM;QAAE,OAAO;IAAM;AACvB","debugId":null}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Desktop/recreate_coffee/src/lib/auth-server.ts"],"sourcesContent":["// src/lib/auth-server.ts\r\nimport { verifyJwt } from \"@/server/jwt\";\r\n\r\nexport type AuthUser = { id: number; login: string; role: string };\r\n\r\nexport class AuthError extends Error {\r\n  status = 401;\r\n  constructor(msg = \"Unauthorized\") { super(msg); }\r\n}\r\n\r\nexport function readBearer(req: Request): string | null {\r\n  const h = req.headers.get(\"authorization\") || \"\";\r\n  if (h.startsWith(\"Bearer \")) return h.slice(7).trim();\r\n  // допускаем токен без префикса (на всякий случай)\r\n  return h ? h.trim() : null;\r\n}\r\n\r\nexport function requireUser(req: Request): AuthUser {\r\n  const token = readBearer(req);\r\n  const payload = token ? verifyJwt(token) : null;\r\n  if (!payload) throw new AuthError();\r\n  return { id: payload.id, login: payload.login, role: payload.role };\r\n}\r\n"],"names":[],"mappings":"AAAA,yBAAyB;;;;;;;;;AACzB;;AAIO,MAAM,kBAAkB;IAC7B,SAAS,IAAI;IACb,YAAY,MAAM,cAAc,CAAE;QAAE,KAAK,CAAC;IAAM;AAClD;AAEO,SAAS,WAAW,GAAY;IACrC,MAAM,IAAI,IAAI,OAAO,CAAC,GAAG,CAAC,oBAAoB;IAC9C,IAAI,EAAE,UAAU,CAAC,YAAY,OAAO,EAAE,KAAK,CAAC,GAAG,IAAI;IACnD,kDAAkD;IAClD,OAAO,IAAI,EAAE,IAAI,KAAK;AACxB;AAEO,SAAS,YAAY,GAAY;IACtC,MAAM,QAAQ,WAAW;IACzB,MAAM,UAAU,QAAQ,IAAA,mIAAS,EAAC,SAAS;IAC3C,IAAI,CAAC,SAAS,MAAM,IAAI;IACxB,OAAO;QAAE,IAAI,QAAQ,EAAE;QAAE,OAAO,QAAQ,KAAK;QAAE,MAAM,QAAQ,IAAI;IAAC;AACpE","debugId":null}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Desktop/recreate_coffee/src/app/api/admin/orders/route.ts"],"sourcesContent":["// src/app/api/admin/orders/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { requireUser, AuthError } from \"@/lib/auth-server\";\r\n\r\nexport const runtime = \"nodejs\";\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    const user = requireUser(req);\r\n    if ((user.role || \"\").toLowerCase() !== \"admin\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const orders = await prisma.order.findMany({\r\n      orderBy: { createdAt: \"desc\" },\r\n      select: {\r\n        id: true,\r\n        status: true,\r\n        totalCents: true,\r\n        createdAt: true,\r\n        customer: {\r\n          select: {\r\n            id: true,\r\n            login: true,\r\n            city: { select: { name: true } },\r\n            street: { select: { name: true } },\r\n            houseNumber: true,\r\n            paymentMethod: true,\r\n          },\r\n        },\r\n        items: {\r\n          select: {\r\n            id: true,\r\n            size: true,\r\n            additivesJson: true,\r\n            quantity: true,\r\n            unitCents: true,\r\n            product: { select: { id: true, name: true } },\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    // Нормализуем адрес\r\n    const norm = orders.map(o => ({\r\n      ...o,\r\n      customer: o.customer && {\r\n        id: o.customer.id,\r\n        login: o.customer.login,\r\n        city: o.customer.city?.name,\r\n        street: o.customer.street?.name,\r\n        houseNumber: o.customer.houseNumber,\r\n        paymentMethod: o.customer.paymentMethod,\r\n      },\r\n    }));\r\n\r\n    return NextResponse.json({ data: { orders: norm }, message: \"OK\", error: null });\r\n  } catch (e: any) {\r\n    if (e instanceof AuthError) {\r\n      return NextResponse.json({ error: e.message }, { status: e.status });\r\n    }\r\n    console.error(\"GET /api/admin/orders error:\", e);\r\n    return NextResponse.json({ error: \"Failed to load orders\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,oCAAoC;;;;;;;AACpC;AACA;AACA;;;;AAEO,MAAM,UAAU;AAEhB,eAAe,IAAI,GAAY;IACpC,IAAI;QACF,MAAM,OAAO,IAAA,6IAAW,EAAC;QACzB,IAAI,CAAC,KAAK,IAAI,IAAI,EAAE,EAAE,WAAW,OAAO,SAAS;YAC/C,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAY,GAAG;gBAAE,QAAQ;YAAI;QACjE;QAEA,MAAM,SAAS,MAAM,gIAAM,CAAC,KAAK,CAAC,QAAQ,CAAC;YACzC,SAAS;gBAAE,WAAW;YAAO;YAC7B,QAAQ;gBACN,IAAI;gBACJ,QAAQ;gBACR,YAAY;gBACZ,WAAW;gBACX,UAAU;oBACR,QAAQ;wBACN,IAAI;wBACJ,OAAO;wBACP,MAAM;4BAAE,QAAQ;gCAAE,MAAM;4BAAK;wBAAE;wBAC/B,QAAQ;4BAAE,QAAQ;gCAAE,MAAM;4BAAK;wBAAE;wBACjC,aAAa;wBACb,eAAe;oBACjB;gBACF;gBACA,OAAO;oBACL,QAAQ;wBACN,IAAI;wBACJ,MAAM;wBACN,eAAe;wBACf,UAAU;wBACV,WAAW;wBACX,SAAS;4BAAE,QAAQ;gCAAE,IAAI;gCAAM,MAAM;4BAAK;wBAAE;oBAC9C;gBACF;YACF;QACF;QAEA,oBAAoB;QACpB,MAAM,OAAO,OAAO,GAAG,CAAC,CAAA,IAAK,CAAC;gBAC5B,GAAG,CAAC;gBACJ,UAAU,EAAE,QAAQ,IAAI;oBACtB,IAAI,EAAE,QAAQ,CAAC,EAAE;oBACjB,OAAO,EAAE,QAAQ,CAAC,KAAK;oBACvB,MAAM,EAAE,QAAQ,CAAC,IAAI,EAAE;oBACvB,QAAQ,EAAE,QAAQ,CAAC,MAAM,EAAE;oBAC3B,aAAa,EAAE,QAAQ,CAAC,WAAW;oBACnC,eAAe,EAAE,QAAQ,CAAC,aAAa;gBACzC;YACF,CAAC;QAED,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,MAAM;gBAAE,QAAQ;YAAK;YAAG,SAAS;YAAM,OAAO;QAAK;IAChF,EAAE,OAAO,GAAQ;QACf,IAAI,aAAa,2IAAS,EAAE;YAC1B,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,EAAE,OAAO;YAAC,GAAG;gBAAE,QAAQ,EAAE,MAAM;YAAC;QACpE;QACA,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF","debugId":null}}]
}