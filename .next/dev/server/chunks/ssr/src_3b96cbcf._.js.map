{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/recreate/recreate_on_react/src/lib/auth.ts"],"sourcesContent":["\"use client\";\r\n\r\nexport type LoginPayload = { login: string; password: string };\r\nexport type User = {\r\n  id: number; login: string; role: string;\r\n  city?: string; street?: string; houseNumber?: number; paymentMethod?: string; createdAt?: string;\r\n};\r\n\r\nexport const reLogin = /^[A-Za-z][A-Za-z0-9]{2,}$/;\r\nexport const rePassword = /^(?=.*[^\\w\\s]).{6,}$/;\r\n\r\nexport function isLoggedIn() {\r\n  try { return !!localStorage.getItem(\"authToken\"); } catch { return false; }\r\n}\r\nexport function getUser(): User | null {\r\n  try { return JSON.parse(localStorage.getItem(\"user\") || \"null\"); } catch { return null; }\r\n}\r\nexport function signOut() {\r\n  try {\r\n    localStorage.removeItem(\"authToken\");\r\n    localStorage.removeItem(\"user\");\r\n    window.dispatchEvent(new Event(\"auth:logout\"));\r\n    window.dispatchEvent(new Event(\"cart:updated\"));\r\n  } catch {}\r\n}\r\n\r\nexport async function loginViaApi(payload: LoginPayload) {\r\n  const res = await fetch(\"/api/auth/login\", {\r\n    method: \"POST\",\r\n    headers: { accept: \"application/json\", \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify(payload),\r\n  });\r\n  const data = await res.json();\r\n  if (!res.ok) throw new Error(data?.error || `HTTP ${res.status}`);\r\n  return data as { data: { access_token: string; user: User } };\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AAQO,MAAM,UAAU;AAChB,MAAM,aAAa;AAEnB,SAAS;IACd,IAAI;QAAE,OAAO,CAAC,CAAC,aAAa,OAAO,CAAC;IAAc,EAAE,OAAM;QAAE,OAAO;IAAO;AAC5E;AACO,SAAS;IACd,IAAI;QAAE,OAAO,KAAK,KAAK,CAAC,aAAa,OAAO,CAAC,WAAW;IAAS,EAAE,OAAM;QAAE,OAAO;IAAM;AAC1F;AACO,SAAS;IACd,IAAI;QACF,aAAa,UAAU,CAAC;QACxB,aAAa,UAAU,CAAC;QACxB,OAAO,aAAa,CAAC,IAAI,MAAM;QAC/B,OAAO,aAAa,CAAC,IAAI,MAAM;IACjC,EAAE,OAAM,CAAC;AACX;AAEO,eAAe,YAAY,OAAqB;IACrD,MAAM,MAAM,MAAM,MAAM,mBAAmB;QACzC,QAAQ;QACR,SAAS;YAAE,QAAQ;YAAoB,gBAAgB;QAAmB;QAC1E,MAAM,KAAK,SAAS,CAAC;IACvB;IACA,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,MAAM,SAAS,CAAC,KAAK,EAAE,IAAI,MAAM,EAAE;IAChE,OAAO;AACT","debugId":null}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/styles/adminButtons.module.css [app-ssr] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"actions\": \"adminButtons-module__G19wtW__actions\",\n  \"btn\": \"adminButtons-module__G19wtW__btn\",\n  \"btnBack\": \"adminButtons-module__G19wtW__btnBack\",\n  \"btnNew\": \"adminButtons-module__G19wtW__btnNew\",\n  \"btnRow\": \"adminButtons-module__G19wtW__btnRow\",\n  \"header\": \"adminButtons-module__G19wtW__header\",\n  \"headerLeft\": \"adminButtons-module__G19wtW__headerLeft\",\n  \"input\": \"adminButtons-module__G19wtW__input\",\n  \"table\": \"adminButtons-module__G19wtW__table\",\n  \"toastErr\": \"adminButtons-module__G19wtW__toastErr\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 75, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/recreate/recreate_on_react/src/app/admin/users/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { getUser, isLoggedIn, signOut } from \"@/lib/auth\";\r\nimport styles from \"@/styles/adminButtons.module.css\";\r\n\r\ntype U = {\r\n  id: number;\r\n  login: string;\r\n  role: string;\r\n  city?: string | null;\r\n  street?: string | null;\r\n  houseNumber?: number | null;\r\n  paymentMethod?: string | null;\r\n  createdAt?: string;\r\n};\r\n\r\ntype UsersListResp = {\r\n  data?: { users?: U[] };\r\n  message?: string;\r\n  error?: string | null;\r\n};\r\n\r\nfunction errToString(e: unknown): string {\r\n  if (e instanceof Error) return e.message;\r\n  try {\r\n    return String(e);\r\n  } catch {\r\n    return \"Unknown error\";\r\n  }\r\n}\r\n\r\nexport default function AdminUsersPage() {\r\n  const [list, setList] = useState<U[]>([]);\r\n  const [q, setQ] = useState(\"\");\r\n  const [loading, setLoading] = useState(true);\r\n  const [err, setErr] = useState(\"\");\r\n\r\n  const me = getUser();\r\n  const admin = !!me && (me.role || \"\").toLowerCase() === \"admin\";\r\n\r\n  async function load() {\r\n    setLoading(true);\r\n    setErr(\"\");\r\n    try {\r\n      const token = localStorage.getItem(\"authToken\") || \"\";\r\n      const res = await fetch(\"/api/admin/users\", {\r\n        headers: {\r\n          accept: \"application/json\",\r\n          Authorization: token ? `Bearer ${token}` : \"\",\r\n        },\r\n        cache: \"no-store\",\r\n      });\r\n      const json: UsersListResp = await res.json();\r\n      if (!res.ok) throw new Error(json?.error || `HTTP ${res.status}`);\r\n      setList(json?.data?.users || []);\r\n    } catch (e) {\r\n      setErr(errToString(e));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (isLoggedIn()) load();\r\n  }, []);\r\n\r\n  const filtered = useMemo(() => {\r\n    const s = q.trim().toLowerCase();\r\n    if (!s) return list;\r\n    return list.filter(\r\n      (u: U) =>\r\n        String(u.login).toLowerCase().includes(s) ||\r\n        String(u.role).toLowerCase().includes(s) ||\r\n        String(u.city || \"\")\r\n          .toLowerCase()\r\n          .includes(s) ||\r\n        String(u.street || \"\")\r\n          .toLowerCase()\r\n          .includes(s)\r\n    );\r\n  }, [q, list]);\r\n\r\n  if (!isLoggedIn())\r\n    return (\r\n      <main className=\"container\">\r\n        <h1>Admin · Users</h1>\r\n        <a className={styles.btn} href=\"/signin?next=%2Fadmin%2Fusers\">\r\n          Sign in\r\n        </a>\r\n      </main>\r\n    );\r\n\r\n  if (!admin)\r\n    return (\r\n      <main className=\"container\">\r\n        <h1>Admin · Users</h1>\r\n        <p>Forbidden.</p>\r\n        <button className={styles.btn} onClick={signOut}>\r\n          Sign out\r\n        </button>\r\n      </main>\r\n    );\r\n\r\n  async function onCreate() {\r\n    const login = prompt(\r\n      \"Login (letters+digits, ≥3, start with letter):\"\r\n    )?.trim();\r\n    if (!login) return;\r\n    const reLogin = /^[A-Za-z][A-Za-z0-9]{2,}$/;\r\n    if (!reLogin.test(login)) {\r\n      alert(\"Invalid login format\");\r\n      return;\r\n    }\r\n\r\n    const password = prompt(\"Temp password (≥6, ≥1 special):\") || \"\";\r\n    const rePassword = /^(?=.*[^\\w\\s]).{6,}$/;\r\n    if (!rePassword.test(password)) {\r\n      alert(\"Invalid password format\");\r\n      return;\r\n    }\r\n\r\n    await mutate(\"POST\", { login, password });\r\n  }\r\n\r\n  async function onEdit(u: U) {\r\n    const role = prompt(`Role [user/admin]:`, u.role)?.trim() || u.role;\r\n    const paymentMethod =\r\n      prompt(\r\n        `Payment method [cash/card or empty]:`,\r\n        u.paymentMethod || \"\"\r\n      )?.trim() || null;\r\n    await mutate(\"PATCH\", { role, paymentMethod }, u.id);\r\n  }\r\n\r\n  async function onResetPassword(u: U) {\r\n    const password =\r\n      prompt(`New password for \"${u.login}\" (≥6, ≥1 special):`) || \"\";\r\n    const rePassword = /^(?=.*[^\\w\\s]).{6,}$/;\r\n    if (!rePassword.test(password)) {\r\n      alert(\"Invalid password format\");\r\n      return;\r\n    }\r\n    await mutate(\"PATCH\", { password }, u.id);\r\n    alert(\"Password reset.\");\r\n  }\r\n\r\n  async function onDelete(u: U) {\r\n    if (!confirm(`Delete user \"${u.login}\"? This cannot be undone.`)) return;\r\n    await mutate(\"DELETE\", null, u.id);\r\n  }\r\n\r\n  async function mutate(\r\n    method: \"POST\" | \"PATCH\" | \"DELETE\",\r\n    body?: any,\r\n    id?: number\r\n  ) {\r\n    setErr(\"\");\r\n    try {\r\n      const token = localStorage.getItem(\"authToken\") || \"\";\r\n      const url = id ? `/api/admin/users/${Number(id)}` : \"/api/admin/users\";\r\n      const res = await fetch(url, {\r\n        method,\r\n        headers: {\r\n          accept: \"application/json\",\r\n          Authorization: token ? `Bearer ${token}` : \"\",\r\n          ...(method !== \"DELETE\"\r\n            ? { \"Content-Type\": \"application/json\" }\r\n            : {}),\r\n        },\r\n        body: method !== \"DELETE\" ? JSON.stringify(body || {}) : undefined,\r\n      });\r\n      const json: UsersListResp = await res.json();\r\n      if (!res.ok) throw new Error(json?.error || `HTTP ${res.status}`);\r\n      await load();\r\n    } catch (e) {\r\n      setErr(errToString(e));\r\n    }\r\n  }\r\n\r\n  return (\r\n    <main className=\"container\">\r\n      <header className={styles.header}>\r\n        <div className={styles.btnRow}>\r\n          <input\r\n            className={styles.input}\r\n            placeholder=\"Search…\"\r\n            value={q}\r\n            onChange={(e) => setQ(e.target.value)}\r\n          />\r\n          <button className={styles.btn} onClick={load} disabled={loading}>\r\n            {loading ? \"Loading…\" : \"Refresh\"}\r\n          </button>\r\n        </div>\r\n      </header>\r\n\r\n      {err && <div className={styles.toastErr}>{err}</div>}\r\n      <br />\r\n      <div>\r\n        <div>\r\n          <a href=\"/admin\" className={styles.btnBack}>\r\n            Return\r\n          </a>\r\n          <h1>Users</h1>\r\n        </div>\r\n        <table className={styles.table}>\r\n          <thead>\r\n            <tr>\r\n              <th>ID</th>\r\n              <th>Login</th>\r\n              <th>Role</th>\r\n              <th>Address</th>\r\n              <th>Pay by</th>\r\n              <th>Created</th>\r\n              <th>Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {filtered.map((u: U) => {\r\n              const addr = [u.city, u.street, u.houseNumber]\r\n                .filter(Boolean)\r\n                .join(\", \");\r\n              return (\r\n                <tr key={u.id}>\r\n                  <td>#{u.id}</td>\r\n                  <td>{u.login}</td>\r\n                  <td>\r\n                    <span className=\"badge\">{u.role}</span>\r\n                  </td>\r\n                  <td>{addr || \"-\"}</td>\r\n                  <td>{u.paymentMethod || \"-\"}</td>\r\n                  <td>\r\n                    {u.createdAt ? new Date(u.createdAt).toLocaleString() : \"\"}\r\n                  </td>\r\n                  <td className={styles.actions}>\r\n                    <button className={styles.btn} onClick={() => onEdit(u)}>\r\n                      Edit\r\n                    </button>\r\n                    <button\r\n                      className={styles.btn}\r\n                      onClick={() => onResetPassword(u)}\r\n                    >\r\n                      Reset password\r\n                    </button>\r\n                    <button className={styles.btn} onClick={() => onDelete(u)}>\r\n                      Delete\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n            {filtered.length === 0 && !loading && (\r\n              <tr>\r\n                <td colSpan={7}>No users.</td>\r\n              </tr>\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}