{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Desktop/recreate_coffee/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line no-var\r\n  var prismaGlobal: PrismaClient | undefined;\r\n}\r\n\r\nexport const prisma =\r\n  global.prismaGlobal ||\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"error\", \"warn\"] : [\"error\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") global.prismaGlobal = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAOO,MAAM,SACX,OAAO,YAAY,IACnB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,OAAO,YAAY,GAAG","debugId":null}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Desktop/recreate_coffee/src/server/jwt.ts"],"sourcesContent":["import jwt from \"jsonwebtoken\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"dev_secret_fallback\";\r\n\r\nexport type JwtPayload = { id: number; login: string; role: string };\r\n\r\nexport function signJwt(payload: JwtPayload, days = 7) {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: `${days}d` });\r\n}\r\n\r\nexport function verifyJwt(token: string): JwtPayload | null {\r\n  try { return jwt.verify(token, JWT_SECRET) as JwtPayload; }\r\n  catch { return null; }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAItC,SAAS,QAAQ,OAAmB,EAAE,OAAO,CAAC;IACnD,OAAO,2MAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW,GAAG,KAAK,CAAC,CAAC;IAAC;AAC/D;AAEO,SAAS,UAAU,KAAa;IACrC,IAAI;QAAE,OAAO,2MAAG,CAAC,MAAM,CAAC,OAAO;IAA2B,EAC1D,OAAM;QAAE,OAAO;IAAM;AACvB","debugId":null}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Desktop/recreate_coffee/src/app/api/admin/users/%5Bid%5D/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { verifyJwt } from \"@/server/jwt\";\r\n\r\nfunction unauthorized() {\r\n  return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n}\r\nfunction forbidden() {\r\n  return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n}\r\nfunction bad(msg=\"Bad request\") {\r\n  return NextResponse.json({ error: msg }, { status: 400 });\r\n}\r\n\r\nexport async function PATCH(req: Request, ctx: { params: { id: string } }) {\r\n  const token = (req.headers.get(\"authorization\") || \"\").replace(/^Bearer\\s+/i,\"\");\r\n  const me = verifyJwt(token);\r\n  if (!me) return unauthorized();\r\n  if ((me.role||\"\").toLowerCase()!==\"admin\") return forbidden();\r\n\r\n  const id = Number(ctx.params.id);\r\n  if (!id) return bad(\"Invalid id\");\r\n\r\n  const body = await req.json().catch(()=> ({}));\r\n  const data: any = {};\r\n  if (typeof body.role === \"string\") data.role = body.role;\r\n  if (typeof body.paymentMethod === \"string\" || body.paymentMethod === null) data.paymentMethod = body.paymentMethod;\r\n\r\n  if (!Object.keys(data).length) return bad(\"Nothing to update\");\r\n\r\n  const updated = await prisma.user.update({ where: { id }, data });\r\n  return NextResponse.json({ data: { id: updated.id }, message:\"Updated\", error:null });\r\n}\r\n\r\nexport async function DELETE(req: Request, ctx: { params: { id: string } }) {\r\n  const token = (req.headers.get(\"authorization\") || \"\").replace(/^Bearer\\s+/i,\"\");\r\n  const me = verifyJwt(token);\r\n  if (!me) return unauthorized();\r\n  if ((me.role||\"\").toLowerCase()!==\"admin\") return forbidden();\r\n\r\n  const id = Number(ctx.params.id);\r\n  if (!id) return bad(\"Invalid id\");\r\n\r\n  // каскад удалит Order -> OrderItem\r\n  await prisma.user.delete({ where: { id } });\r\n  return NextResponse.json({ data: { id }, message:\"Deleted\", error:null });\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,SAAS;IACP,OAAO,+QAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAe,GAAG;QAAE,QAAQ;IAAI;AACpE;AACA,SAAS;IACP,OAAO,+QAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAY,GAAG;QAAE,QAAQ;IAAI;AACjE;AACA,SAAS,IAAI,MAAI,aAAa;IAC5B,OAAO,+QAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAI,GAAG;QAAE,QAAQ;IAAI;AACzD;AAEO,eAAe,MAAM,GAAY,EAAE,GAA+B;IACvE,MAAM,QAAQ,CAAC,IAAI,OAAO,CAAC,GAAG,CAAC,oBAAoB,EAAE,EAAE,OAAO,CAAC,eAAc;IAC7E,MAAM,KAAK,IAAA,mIAAS,EAAC;IACrB,IAAI,CAAC,IAAI,OAAO;IAChB,IAAI,CAAC,GAAG,IAAI,IAAE,EAAE,EAAE,WAAW,OAAK,SAAS,OAAO;IAElD,MAAM,KAAK,OAAO,IAAI,MAAM,CAAC,EAAE;IAC/B,IAAI,CAAC,IAAI,OAAO,IAAI;IAEpB,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAK,CAAC,CAAC,CAAC;IAC5C,MAAM,OAAY,CAAC;IACnB,IAAI,OAAO,KAAK,IAAI,KAAK,UAAU,KAAK,IAAI,GAAG,KAAK,IAAI;IACxD,IAAI,OAAO,KAAK,aAAa,KAAK,YAAY,KAAK,aAAa,KAAK,MAAM,KAAK,aAAa,GAAG,KAAK,aAAa;IAElH,IAAI,CAAC,OAAO,IAAI,CAAC,MAAM,MAAM,EAAE,OAAO,IAAI;IAE1C,MAAM,UAAU,MAAM,gIAAM,CAAC,IAAI,CAAC,MAAM,CAAC;QAAE,OAAO;YAAE;QAAG;QAAG;IAAK;IAC/D,OAAO,+QAAY,CAAC,IAAI,CAAC;QAAE,MAAM;YAAE,IAAI,QAAQ,EAAE;QAAC;QAAG,SAAQ;QAAW,OAAM;IAAK;AACrF;AAEO,eAAe,OAAO,GAAY,EAAE,GAA+B;IACxE,MAAM,QAAQ,CAAC,IAAI,OAAO,CAAC,GAAG,CAAC,oBAAoB,EAAE,EAAE,OAAO,CAAC,eAAc;IAC7E,MAAM,KAAK,IAAA,mIAAS,EAAC;IACrB,IAAI,CAAC,IAAI,OAAO;IAChB,IAAI,CAAC,GAAG,IAAI,IAAE,EAAE,EAAE,WAAW,OAAK,SAAS,OAAO;IAElD,MAAM,KAAK,OAAO,IAAI,MAAM,CAAC,EAAE;IAC/B,IAAI,CAAC,IAAI,OAAO,IAAI;IAEpB,mCAAmC;IACnC,MAAM,gIAAM,CAAC,IAAI,CAAC,MAAM,CAAC;QAAE,OAAO;YAAE;QAAG;IAAE;IACzC,OAAO,+QAAY,CAAC,IAAI,CAAC;QAAE,MAAM;YAAE;QAAG;QAAG,SAAQ;QAAW,OAAM;IAAK;AACzE","debugId":null}}]
}